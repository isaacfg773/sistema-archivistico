<!-- ======================== LOGIN ======================== -->
<div class="app-root" *ngIf="!loggedIn">
  <div class="login-wrapper">
    <div class="login-card">
      <div class="login-header">
        <div class="logo-circle">D</div>
        <div>
          <h1>SISTEMA ARCHIV√çSTICO</h1>
          <p>DDE - COCHABAMBA</p>
        </div>
      </div>

      <form (ngSubmit)="onLogin()" class="login-form">
        <div class="form-group">
          <label>Usuario</label>
          <input
            type="text"
            [(ngModel)]="loginUser"
            name="loginUser"
            required
          />
        </div>

        <div class="form-group">
          <label>Contrase√±a</label>
          <input
            type="password"
            [(ngModel)]="loginPass"
            name="loginPass"
            required
          />
        </div>

        <button class="btn btn-primary" type="submit">
          Iniciar sesi√≥n
        </button>

        <p
          class="login-msg"
          [class.error]="loginError"
          *ngIf="loginMsg"
        >
          {{ loginMsg }}
        </p>
      </form>
    </div>
  </div>
</div>

<!-- ======================== APLICACI√ìN ======================== -->
<div class="app-root" *ngIf="loggedIn">
  <!-- Barra superior -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">D</div>
      <div class="topbar-text">
        <span class="title">SISTEMA ARCHIV√çSTICO</span>
        <span class="subtitle">DDE - COCHABAMBA</span>
      </div>
    </div>
    <button class="btn btn-outline" (click)="cerrarSesion()">
      Cerrar sesi√≥n
    </button>
  </header>

  <div class="layout">
    <!-- Men√∫ lateral -->
    <nav class="sidebar">
      <h3>M√ìDULOS</h3>
      <button
        class="sidebar-item"
        [ngClass]="{ active: selectedModule === 'registro' }"
        (click)="selectedModule = 'registro'"
      >
        Registro de documentos
      </button>
      <button
        class="sidebar-item"
        [ngClass]="{ active: selectedModule === 'tabla' }"
        (click)="selectedModule = 'tabla'"
      >
        Tabla de datos
      </button>
      <button
        class="sidebar-item"
        [ngClass]="{ active: selectedModule === 'texto' }"
        (click)="selectedModule = 'texto'"
      >
        B√∫squeda por texto
      </button>
      <button
        class="sidebar-item"
        [ngClass]="{ active: selectedModule === 'voz' }"
        (click)="selectedModule = 'voz'"
      >
        B√∫squeda por voz
      </button>
    </nav>

    <!-- Contenido principal -->
    <main class="content">
      <!-- ========= M√ìDULO: REGISTRO ========= -->
      <section *ngIf="selectedModule === 'registro'">
        <h2>Registro de documentos</h2>
        <p class="section-subtitle">
          Registra los documentos indicando sus datos y la URL de Google Drive.
        </p>

        <form class="grid-2" (ngSubmit)="agregarDocumento()">
          <div class="form-group">
            <label>C√≥digo *</label>
            <input
              type="text"
              [(ngModel)]="formCodigo"
              name="formCodigo"
              required
            />
          </div>

          <div class="form-group">
            <label>T√≠tulo *</label>
            <input
              type="text"
              [(ngModel)]="formTitulo"
              name="formTitulo"
              required
            />
          </div>

          <div class="form-group full">
            <label>Descripci√≥n</label>
            <textarea
              rows="2"
              [(ngModel)]="formDescripcion"
              name="formDescripcion"
            ></textarea>
          </div>

          <div class="form-group">
            <label>Categor√≠a</label>
            <input
              type="text"
              [(ngModel)]="formCategoria"
              name="formCategoria"
            />
          </div>

          <div class="form-group">
            <label>Enlace de Google Drive (o URL del PDF) *</label>
            <input
              type="url"
              [(ngModel)]="formUrl"
              name="formUrl"
              required
            />
            <small class="help">
              Puedes pegar un enlace como:
              <code>https://drive.google.com/file/d/ID/...</code>.
              El sistema extraer√° autom√°ticamente el ID para usar
              <code>/preview</code>.
            </small>
          </div>

          <div class="form-actions full">
            <button type="submit" class="btn btn-primary">
              Guardar documento
            </button>
          </div>
        </form>

        <p class="info-msg" *ngIf="registroMsg">{{ registroMsg }}</p>
      </section>

      <!-- ========= M√ìDULO: TABLA ========= -->
      <section *ngIf="selectedModule === 'tabla'">
        <h2>Tabla de datos</h2>
        <p class="section-subtitle">
          Lista de documentos registrados en memoria durante esta sesi√≥n.
        </p>

        <ng-container *ngIf="documentos.length > 0; else sinDocs">
          <table class="data-table">
            <thead>
              <tr>
                <th>C√ìDIGO</th>
                <th>T√çTULO</th>
                <th>CATEGOR√çA</th>
                <th>VER</th>
                <th>ELIMINAR</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of documentos">
                <td>{{ d.codigo }}</td>
                <td>{{ d.titulo }}</td>
                <td>{{ d.categoria }}</td>
                <td>
                  <button class="btn-link" (click)="verDocumento(d)">
                    Ver documento
                  </button>
                </td>
                <td>
                  <button class="btn-link danger" (click)="eliminarDocumento(d.id)">
                    Eliminar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>

        <!-- Visor -->
        <section class="viewer" *ngIf="selectedDocumentUrl">
          <h3>{{ selectedDocumentTitle }}</h3>
          <iframe
            [src]="selectedDocumentUrl"
            width="100%"
            height="600"
            frameborder="0"
            allowfullscreen
          ></iframe>
        </section>
      </section>

      <!-- ========= M√ìDULO: B√öSQUEDA POR TEXTO ========= -->
      <section *ngIf="selectedModule === 'texto'">
        <h2>B√∫squeda por texto</h2>
        <p class="section-subtitle">
          Busca por c√≥digo, t√≠tulo, descripci√≥n o categor√≠a.
        </p>

        <div class="search-bar">
          <input
            type="text"
            placeholder="Escriba su b√∫squeda..."
            [(ngModel)]="searchText"
            name="searchText"
            (keyup.enter)="buscarPorTexto()"
          />
          <button class="btn btn-primary" (click)="buscarPorTexto()">
            Buscar
          </button>
        </div>

        <ng-container *ngIf="resultadosTexto.length > 0; else sinResultadosTexto">
          <table class="data-table">
            <thead>
              <tr>
                <th>C√ìDIGO</th>
                <th>T√çTULO</th>
                <th>CATEGOR√çA</th>
                <th>VER</th>
                <th>ELIMINAR</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of resultadosTexto">
                <td>{{ d.codigo }}</td>
                <td>{{ d.titulo }}</td>
                <td>{{ d.categoria }}</td>
                <td>
                  <button class="btn-link" (click)="verDocumento(d)">
                    Ver documento
                  </button>
                </td>
                <td>
                  <button class="btn-link danger" (click)="eliminarDocumento(d.id)">
                    Eliminar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>

        <!-- Visor -->
        <section class="viewer" *ngIf="selectedDocumentUrl">
          <h3>{{ selectedDocumentTitle }}</h3>
          <iframe
            [src]="selectedDocumentUrl"
            width="100%"
            height="600"
            frameborder="0"
            allowfullscreen
          ></iframe>
        </section>
      </section>

      <!-- ========= M√ìDULO: B√öSQUEDA POR VOZ ========= -->
      <section *ngIf="selectedModule === 'voz'">
        <h2>B√∫squeda por voz</h2>
        <p class="section-subtitle">
          Usa el micr√≥fono para dictar el nombre o parte de los datos del
          documento.
        </p>

        <div class="voice-info" *ngIf="!vozSoportada">
          {{ vozEstado }}
        </div>

        <div class="voice-controls" *ngIf="vozSoportada">
          <div class="search-bar">
            <input
              type="text"
              [(ngModel)]="vozTexto"
              name="vozTexto"
              placeholder="Aqu√≠ aparecer√° lo que dictes..."
            />
            <button class="btn btn-secondary" type="button" (click)="iniciarDictado()">
              üéôÔ∏è Iniciar dictado
            </button>
            <button class="btn btn-primary" type="button" (click)="buscarPorVoz()">
              Buscar
            </button>
          </div>
          <small class="help">{{ vozEstado }}</small>
        </div>

        <ng-container *ngIf="resultadosVoz.length > 0; else sinResultadosVoz">
          <table class="data-table">
            <thead>
              <tr>
                <th>C√ìDIGO</th>
                <th>T√çTULO</th>
                <th>CATEGOR√çA</th>
                <th>VER</th>
                <th>ELIMINAR</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of resultadosVoz">
                <td>{{ d.codigo }}</td>
                <td>{{ d.titulo }}</td>
                <td>{{ d.categoria }}</td>
                <td>
                  <button class="btn-link" (click)="verDocumento(d)">
                    Ver documento
                  </button>
                </td>
                <td>
                  <button class="btn-link danger" (click)="eliminarDocumento(d.id)">
                    Eliminar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>

        <!-- Visor -->
        <section class="viewer" *ngIf="selectedDocumentUrl">
          <h3>{{ selectedDocumentTitle }}</h3>
          <iframe
            [src]="selectedDocumentUrl"
            width="100%"
            height="600"
            frameborder="0"
            allowfullscreen
          ></iframe>
        </section>
      </section>

      <!-- ========= TEMPLATES VAC√çOS ========= -->
      <ng-template #sinDocs>
        <p class="info-msg">No hay documentos registrados todav√≠a.</p>
      </ng-template>

      <ng-template #sinResultadosTexto>
        <p class="info-msg">No se encontraron resultados para esta b√∫squeda.</p>
      </ng-template>

      <ng-template #sinResultadosVoz>
        <p class="info-msg">No se encontraron resultados para esta b√∫squeda por voz.</p>
      </ng-template>
    </main>
  </div>
</div>
